<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Proto TV</title>
  <link rel="icon" href="img/icon.png" type="image/png">
  <!-- Importar script de conversión de horarios -->
  <script src="smallscripts.js"></script>
  <style>
    @font-face { font-family: 'CalSans'; src: url('fonts/CalSans-Regular.ttf') format('opentype'); }
    @font-face { font-family: 'DMSans'; src: url('fonts/DMSans-Regular.ttf') format('truetype'); }
    body {
      font-family: 'DMSans', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen;
      background: linear-gradient(to bottom, #b6359c, #ef0a6a);
      margin: 0; padding: 40px 20px; padding-top: 100px;
      display: flex; flex-direction: column; align-items: center;
      min-height: 100vh; position: relative;
      color: #333;
    }
    .site-logo-link { position: absolute; top: 20px; left: 20px; z-index: 10; }
    .site-logo-link img { height: 60px; width: auto; display: block; }
    h1 { font-family: 'CalSans', sans-serif; text-align: center; color: #fff; margin: 0 0 40px; }
    #channel-grid { display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; max-width: 900px; width: 100%; margin-bottom: 40px; }
    .channel-item { text-decoration: none; color: inherit; text-align: center; transition: transform 0.2s; display: flex; flex-direction: column; }
    .channel-item:hover { transform: translateY(-5px); }
    .channel-item img { width: 180px; height: 180px; object-fit: cover; border-radius: 12px; }
    #agenda-container { width: 100%; max-width: 900px; background: #fff; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 20px; }
    #agenda-container h2 { margin-top: 0; color: #ef0a6a; text-align: center; }
    #agenda-table { width: 100%; border-collapse: collapse; }
    #agenda-table th, #agenda-table td { border: 1px solid #ddd; padding: 8px; }
    #agenda-table th { background: #f5f5f5; }
    @media (max-width: 700px) {
      body { padding: 20px 15px; padding-top: 90px; }
      .site-logo-link { top: 15px; left: 15px; }
      .site-logo-link img { height: 50px; }
      h1 { font-size: 1.8em; margin-bottom: 30px; }
      #channel-grid { gap: 15px; justify-content: space-around; }
      .channel-item img { width: 120px; height: 120px; }
      #agenda-container { padding: 15px; }
    }
  </style>
</head>
<body>
  <a href="index.html" class="site-logo-link">
    <img src="img/logo.png" alt="ONLiVE_logo">
  </a>
  <h1>DEPORTES</h1>

  <div id="channel-grid">
    <a href="sports-channel/directv_sports.html" class="channel-item">
      <img src="img/directv_sports.png" alt="DirecTV Sports">
    </a>
    <a href="sports-channel/tnt_sports.html" class="channel-item">
      <img src="img/tnt_sports.png" alt="TNT Sports">
    </a>
    <a href="sports-channel/espn.html" class="channel-item">
      <img src="img/espn.png" alt="ESPN">
    </a>
  </div>

  <section id="agenda-container">
    <h2>Cargando agenda...</h2>
  </section>

  <script>
    (async function() {
      try {
        const proxy = 'https://api.allorigins.win/raw?url=';
        const targetUrl = encodeURIComponent('https://pelota-libre.org/agenda/');
        const resp = await fetch(proxy + targetUrl);
        const htmlText = await resp.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(htmlText, 'text/html');

        const centerEl = doc.querySelector('center');
        const headerText = centerEl ? centerEl.textContent.trim() : 'Agenda deportiva';

        const entries = Array.from(doc.querySelectorAll('li.AR'));

        const container = document.getElementById('agenda-container');
        container.innerHTML = '';

        const title = document.createElement('h2');
        title.textContent = headerText;
        container.appendChild(title);

        const table = document.createElement('table');
        table.id = 'agenda-table';

        const thead = document.createElement('thead');
        const headRow = document.createElement('tr');
        ['Partido', 'Horario (GMT-3)', 'Canales'].forEach(txt => {
          const th = document.createElement('th'); th.textContent = txt; headRow.appendChild(th);
        });
        thead.appendChild(headRow);
        table.appendChild(thead);

        const tbody = document.createElement('tbody');

        entries.forEach(li => {
          const mainA = li.querySelector('a:not([target])');
          if (!mainA) return;

          const spanTime = mainA.querySelector('span.t');
          const rawTime = spanTime ? spanTime.textContent.trim() : '';
          if (spanTime) spanTime.remove();

          let text = mainA.textContent.trim();
          const parts = text.split(/\s+/);
          if (!/^[A-Za-zÀ-ÖØ-öø-ÿ]/.test(parts[0])) parts.shift();
          text = parts.join(' ').replace(/^Superliga Argentina:\s*/, '');

          const channelLinks = Array.from(li.querySelectorAll('ul > li.subitem1 > a'));
          const channels = channelLinks.map(a => {
            const sp = a.querySelector('span'); if (sp) sp.remove();
            return a.textContent.trim();
          });

          // Crear elementos sin formatear
          const tr = document.createElement('tr');
          const tdMatch = document.createElement('td'); tdMatch.textContent = text;
          const tdTime = document.createElement('td'); tdTime.textContent = rawTime; tdTime.classList.add('t');
          const tdChan = document.createElement('td'); tdChan.textContent = channels.length ? channels.join(', ') : '-';
          tr.append(tdMatch, tdTime, tdChan);
          tbody.appendChild(tr);
        });

        table.appendChild(tbody);
        container.appendChild(table);

        // Aplicar conversión de horarios al DOM actual
        if (window.guardaHorario && window.dT) {
          guardaHorario();
          dT();
        }

      } catch (err) {
        document.getElementById('agenda-container').innerHTML = '<p>Error al cargar la agenda.</p>';
        console.error(err);
      }
    })();
  </script>
</body>
</html>
