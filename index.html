<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Proto TV</title>
  <link rel="icon" href="img/icon.png" type="image/png">
  <!-- Importar script de conversión de horarios -->
  <script src="smallscripts.js"></script>
  <style>
    @font-face { font-family: 'CalSans'; src: url('fonts/CalSans-Regular.ttf') format('opentype'); }
    @font-face { font-family: 'DMSans'; src: url('fonts/DMSans-Regular.ttf') format('truetype'); }
    body {
      font-family: 'DMSans', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen;
      /* background-color: #001029; */ /* Eliminamos el color sólido */
      background-color: transparent; /* Hacemos el fondo del body transparente */
      margin: 0; padding: 40px 20px; padding-top: 100px;
      display: flex; flex-direction: column; align-items: center;
      min-height: 100vh; position: relative; /* Mantenemos position: relative */
      color: #333;
      z-index: 1; /* Asegura que el contenido esté sobre el fondo desenfocado */
    }
    body::before {
      content: ''; /* Requerido para pseudo-elementos */
      position: fixed; /* Fija el fondo a la ventana */
      top: 0; 
      left: 0;
      width: 100%; 
      height: 100%;
      background-image: url('img/background.webp'); /* Establece la imagen de fondo */
      background-size: cover; /* Cubre todo el área */
      background-position: center; /* Centra la imagen */
      filter: blur(10px); /* Aplica el desenfoque (ajusta '10px' si necesitas más o menos blur) */
      z-index: -1; /* Coloca el pseudo-elemento detrás del contenido del body */
    }
    .site-logo-link { position: absolute; top: 20px; left: 20px; z-index: 10; }
    .site-logo-link img { height: 42px; width: auto; display: block; } /* Altura reducida */
    h1 { 
      font-family: 'CalSans', sans-serif; 
      text-align: center; 
      color: #fff; 
      margin: 0 0 40px; 
      font-size: 37px; /* Tamaño aumentado (aplicado a todos los tamaños) */
      letter-spacing: 2px; /* Interletrado añadido (aplicado a todos los tamaños) */
    }
    #channel-grid { display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; max-width: 900px; width: 100%; margin-bottom: 40px; }
    .channel-item { text-decoration: none; color: inherit; text-align: center; transition: transform 0.2s; display: flex; flex-direction: column; }
    .channel-item:hover { transform: translateY(-5px); }
    .channel-item img { width: 180px; height: 180px; object-fit: cover; border-radius: 12px; }
    #agenda-container { width: 100%; max-width: 900px; background: #fff; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 20px; }
    #agenda-container h2 { margin-top: 0; color: #ef0a6a; text-align: center; }
    #agenda-table { width: 100%; border-collapse: collapse; }
    #agenda-table th, #agenda-table td { border: 1px solid #ddd; padding: 8px; }
    #agenda-table th { background: #f5f5f5; }
    @media (max-width: 700px) {
      body { padding: 20px 15px; padding-top: 90px; }
      .site-logo-link { position: absolute; top: 15px; left: 15px; } /* Ajustado para móvil */
      .site-logo-link img { height: 50px; } /* Tamaño de logo para móvil */
      h1 { 
        font-size: 1.8em; /* Tamaño específico para móvil */ 
        margin-bottom: 30px; 
        /* Ya no se necesita font-family, text-align, color, letter-spacing aquí si son iguales al general */
      }
      #channel-grid { gap: 15px; justify-content: space-around; }
      .channel-item img { width: 120px; height: 120px; }
      #agenda-container { padding: 15px; }
    }
  </style>
</head>
<body>
  <a href="index.html" class="site-logo-link">
    <img src="img/logo.png" alt="ONLiVE_logo">
  </a>
  <h1>DEPORTES</h1>

  <div id="channel-grid">
    <a href="sports-channel/directv_sports.html" class="channel-item">
      <img src="img/directv_sports.png" alt="DirecTV Sports">
    </a>
    <a href="sports-channel/tnt_sports.html" class="channel-item">
      <img src="img/tnt_sports.png" alt="TNT Sports">
    </a>
    <a href="sports-channel/espn.html" class="channel-item">
      <img src="img/espn.png" alt="ESPN">
    </a>
  </div>

  <section id="agenda-container">
    <h2>Cargando agenda...</h2>
  </section>

  <script>
    async function updateAgenda() {
      try {
        const proxy = 'https://api.allorigins.win/raw?url=';
        const targetUrl = encodeURIComponent('https://pelota-libre.org/agenda/');
        const resp = await fetch(proxy + targetUrl);
        const htmlText = await resp.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(htmlText, 'text/html');

        const centerEl = doc.querySelector('center');
        const headerText = centerEl ? centerEl.textContent.trim() : 'Agenda deportiva';

        const entries = Array.from(doc.querySelectorAll('li.AR'));

        const container = document.getElementById('agenda-container');
        container.innerHTML = '';

        const title = document.createElement('h2');
        title.textContent = headerText;
        container.appendChild(title);

        const table = document.createElement('table');
        table.id = 'agenda-table';

        const thead = document.createElement('thead');
        const headRow = document.createElement('tr');
        ['Partido', 'Horario', 'Canales'].forEach(txt => {
          const th = document.createElement('th'); th.textContent = txt; headRow.appendChild(th);
        });
        thead.appendChild(headRow);
        table.appendChild(thead);

        const tbody = document.createElement('tbody');

        entries.forEach(li => {
          const mainA = li.querySelector('a:not([target])');
          if (!mainA) return;

          // Extraer span de tiempo y moverlo al TD sin alterar contenido para smallscripts
          const spanTime = mainA.querySelector('span.t');
          const tdTime = document.createElement('td');
          if (spanTime) {
            // Simplemente usar el texto del span directamente sin crear un nuevo span con clase 't'
            tdTime.textContent = spanTime.textContent;
          } else {
            tdTime.textContent = '';
          }

          // Obtener texto del partido
          let text = mainA.textContent.trim();
          const parts = text.split(/\s+/);
          if (!/^[A-Za-zÀ-ÖØ-öø-ÿ]/.test(parts[0])) parts.shift();
          text = parts.join(' ').replace(/^Superliga Argentina:\s*/, '');
          const tdMatch = document.createElement('td');
          tdMatch.textContent = text;

          // Extraer canales
          const channelLinks = Array.from(li.querySelectorAll('ul > li.subitem1 > a'));
          const channels = channelLinks.map(a => {
            const sp = a.querySelector('span'); if (sp) sp.remove();
            return a.textContent.trim();
          });
          const tdChan = document.createElement('td');
          tdChan.textContent = channels.length ? channels.join(', ') : '-';

          const tr = document.createElement('tr');
          tr.append(tdMatch, tdTime, tdChan);
          tbody.appendChild(tr);
        });

        table.appendChild(tbody);
        container.appendChild(table);
        if (typeof convertTimes === 'function') {
          convertTimes(); 
        }

      } catch (err) {
        // Muestra un mensaje más discreto en caso de error recurrente
        const container = document.getElementById('agenda-container');
        if (!container.querySelector('.error-message')) { // Evita mensajes duplicados
            const errorP = document.createElement('p');
            errorP.textContent = 'Error al actualizar la agenda.';
            errorP.className = 'error-message'; // Clase para identificarlo
            // Inserta el error después del título si existe, o al principio
            const titleH2 = container.querySelector('h2');
            if (titleH2) {
                titleH2.insertAdjacentElement('afterend', errorP);
            } else {
                container.prepend(errorP);
            }
        }
        console.error('Error actualizando agenda:', err);
      }
    }

    // Llama a la función inmediatamente para cargar la agenda al inicio
    updateAgenda();

    // Establece un intervalo para llamar a updateAgenda cada 5 minutos (300000 ms)
    setInterval(updateAgenda, 60000);
  </script>
</body>
</html>
